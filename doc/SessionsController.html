<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: SessionsController
  
    &mdash; Documentation by YARD 0.9.12
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "SessionsController";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (S)</a> &raquo;
    
    
    <span class="title">SessionsController</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: SessionsController
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ActionController::Base</li>
          
            <li class="next"><span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></li>
          
            <li class="next">SessionsController</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>app/controllers/sessions_controller.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Handles all logic related to sessions: oauth &amp; signout</p>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create-instance_method" title="#create (instance method)">#<strong>create</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>GET /oauth/callback/github Github OAuth API callback Sign in the user (and
creates an account if necessary).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#destroy-instance_method" title="#destroy (instance method)">#<strong>destroy</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>DELETE /logout logout the user by erasing its session.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#new-instance_method" title="#new (instance method)">#<strong>new</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>GET /login for now, directly redirects to github handler as only github is
supported for auth if the user is already authenticated, redirect to root
path as there is nothing to do.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Authentication.html" title="Authentication (module)">Authentication</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Authentication.html#already_authenticated!-instance_method" title="Authentication#already_authenticated! (method)">#already_authenticated!</a></span>, <span class='object_link'><a href="Authentication.html#authenticate!-instance_method" title="Authentication#authenticate! (method)">#authenticate!</a></span>, <span class='object_link'><a href="Authentication.html#authenticate_with_session-instance_method" title="Authentication#authenticate_with_session (method)">#authenticate_with_session</a></span>, <span class='object_link'><a href="Authentication.html#authenticated%3F-instance_method" title="Authentication#authenticated? (method)">#authenticated?</a></span>, <span class='object_link'><a href="Authentication.html#current_user-instance_method" title="Authentication#current_user (method)">#current_user</a></span>, <span class='object_link'><a href="Authentication.html#user_signed_in%3F-instance_method" title="Authentication#user_signed_in? (method)">#user_signed_in?</a></span></p>

  
  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="create-instance_method">
  
    #<strong>create</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>GET /oauth/callback/github Github OAuth API callback Sign in the user (and
creates an account if necessary)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/sessions_controller.rb', line 19</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create'>create</span>
  <span class='comment'># convert code into access token
</span>  <span class='id identifier rubyid_access_token'>access_token</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Github.html" title="Github (module)">Github</a></span></span><span class='op'>::</span><span class='id identifier rubyid_oauth_exchange_code_for_token'><span class='object_link'><a href="Github.html#oauth_exchange_code_for_token-class_method" title="Github.oauth_exchange_code_for_token (method)">oauth_exchange_code_for_token</a></span></span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:code</span><span class='rbracket'>]</span>

  <span class='comment'># fetch github profile information
</span>  <span class='id identifier rubyid_github_profile'>github_profile</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Github.html" title="Github (module)">Github</a></span></span><span class='op'>::</span><span class='id identifier rubyid_profile'><span class='object_link'><a href="Github.html#profile-class_method" title="Github.profile (method)">profile</a></span></span> <span class='id identifier rubyid_access_token'>access_token</span>

  <span class='comment'># try to fetch user profile in DB
</span>  <span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="User.html" title="User (class)">User</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find_or_initialize_by'>find_or_initialize_by</span><span class='lparen'>(</span><span class='label'>github_ext_id:</span> <span class='id identifier rubyid_github_profile'>github_profile</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>

  <span class='comment'># setup or update profile
</span>  <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_login'>login</span>      <span class='op'>=</span> <span class='id identifier rubyid_github_profile'>github_profile</span><span class='lbracket'>[</span><span class='symbol'>:login</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>       <span class='op'>=</span> <span class='id identifier rubyid_github_profile'>github_profile</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_email'>email</span>      <span class='op'>=</span> <span class='id identifier rubyid_github_profile'>github_profile</span><span class='lbracket'>[</span><span class='symbol'>:email</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_avatar_url'>avatar_url</span> <span class='op'>=</span> <span class='id identifier rubyid_github_profile'>github_profile</span><span class='lbracket'>[</span><span class='symbol'>:avatar_url</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>

  <span class='comment'># setup session
</span>  <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:github_access_token</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_access_token'>access_token</span>
  <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:user_id</span><span class='rbracket'>]</span>             <span class='op'>=</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>

  <span class='comment'># notify the user of the success
</span>  <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:success</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>controllers.sessions_controller.create.success</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='comment'># notify the user of the failure
</span>  <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>controllers.sessions_controller.create.error</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='kw'>ensure</span>
  <span class='comment'># always redirect to the main page
</span>  <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_root_path'>root_path</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="destroy-instance_method">
  
    #<strong>destroy</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>DELETE /logout logout the user by erasing its session</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


52
53
54
55
56
57</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/sessions_controller.rb', line 52</span>

<span class='kw'>def</span> <span class='id identifier rubyid_destroy'>destroy</span>
  <span class='comment'># reset session
</span>  <span class='id identifier rubyid_reset_session'>reset_session</span>
  <span class='comment'># redirect to the home page
</span>  <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_root_path'>root_path</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="new-instance_method">
  
    #<strong>new</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>GET /login for now, directly redirects to github handler as only github is
supported for auth if the user is already authenticated, redirect to root
path as there is nothing to do</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


12
13
14</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/sessions_controller.rb', line 12</span>

<span class='kw'>def</span> <span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='const'><span class='object_link'><a href="Github.html" title="Github (module)">Github</a></span></span><span class='op'>::</span><span class='id identifier rubyid_oauth_login_url'><span class='object_link'><a href="Github.html#oauth_login_url-class_method" title="Github.oauth_login_url (method)">oauth_login_url</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sun Dec 10 00:09:59 2017 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.12 (ruby-2.4.2).
</div>

    </div>
  </body>
</html>